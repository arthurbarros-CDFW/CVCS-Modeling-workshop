"0",""
"0","CJS_data_prep<-function(ch,chops,covars){"
"0","#Part 1: prepare ch and covars data"
"0"," ch=ch[-1] #remove disctag vector from capture histories"
"0"," covars$Sex<-ifelse(covars$Sex=='F',1,0) #change sex to numeric value "
"0"," "
"0","#Part 2: prep chops data"
"0"," chops<-chops[-1]"
"0"," clean_chops<-matrix(ncol=ncol(chops))"
"0"," for(i in 1:ncol(chops)){"
"0","   d<-chops[i]"
"0","   r<-rep(0,ncol(chops))"
"0","   r[i]=2"
"0","   r<-matrix(rep((r),d),ncol=ncol(chops),byrow=T)"
"0","   clean_chops<-clean_chops%>%rbind(r)"
"0","   }"
"0"," clean_chops<-clean_chops[-1,]"
"0"," colnames(clean_chops)<-colnames(ch)"
"0"," #add in chops"
"0"," ch<-ch%>%rbind(clean_chops)"
"0"," "
"0","#Part 3: generate sex data for chopped data"
"0"," index = 1:dim(ch)[1]"
"0"," samp<- sample(index, replace = T)"
"0"," "
"0"," covariates_new<-as.matrix(covars[samp,])"
"0"," "
"0"," sex_vector<-covariates_new[,'Sex']"
"0"," no.miss = sex_vector[!is.na(sex_vector)]"
"0"," prop.female<-mean(no.miss)"
"0"," prop.male<-1-prop.female"
"0"," sex_vector<-ifelse(is.na(sex_vector),sample(c(1,0),1,prob=c(prop.female,prop.male)),sex_vector)"
"0"," sex_matrix<-matrix(sex_vector,nrow=nrow(ch),ncol=ncol(ch))"
"0"," "
"0","#Part 4: generate length data for chopped data"
"0"," lengths_vector<-covariates_new[,'Length']"
"0"," females<-covariates_new[covariates_new[,2]==1,]"
"0"," males<-covariates_new[covariates_new[,2]==0,]"
"0"," avg.female.length<-round(mean(as.numeric(females[,3]),na.rm=T),1)"
"0"," avg.male.length<-round(mean(as.numeric(males[,3]),na.rm=T),1)"
"0"," for(i in 1:length(lengths_vector)){"
"0","  if(is.na(lengths_vector[i])){"
"0","     lengths_vector[i] = ifelse(sex_matrix[i,1] == 1,  avg.female.length, avg.male.length)"
"0","   }"
"0"," }"
"0"," lengths_matrix<-matrix(as.numeric(lengths_vector),nrow=nrow(ch),ncol=ncol(ch))"
"0"," "
"0"," return(list('ch'=ch,'lengths_matrix'=lengths_matrix,'sex_matrix'=sex_matrix))"
"0","}"
