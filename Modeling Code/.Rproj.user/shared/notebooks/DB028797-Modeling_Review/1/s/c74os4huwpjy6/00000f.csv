"0","total_escapement<-function(ch,covars){"
"0","  nan=nrow(ch)"
"0","  ns=ncol(ch)"
"0","  "
"0","#Take coefficients and produce p_hat/s_hat"
"0","  p_hat<-s_hat<-matrix( 0, nan, ns )"
"0","  "
"0","  for(i in 1:nan){"
"0","    for(j in 1:ns){"
"0","      p_hat[i,j]<-pro_capsur(beta,i,j,np)$p.hat"
"0","      s_hat[i,j]<-pro_capsur(beta,i,j,np)$s.hat"
"0","    }"
"0","  }"
"0","  #set first row of capture probabilities to NA"
"0","  p_hat[,1]<-NA"
"0","  "
"0","N_hat=Horvitz_Thompson(p_hat,ch)"
"0",""
"0","Bstar=B_star(ch,s_hat,p_hat)"
"0",""
"0","escapement<-N_hat[[2]]*(log(mean(s_hat[,1]))/(mean(s_hat[,1])-1)) +"
"0","  sum(Bstar,na.rm=T)"
"0","  "
"0","return(escapement)"
"0","}"
